<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>askRenewal - IT Help Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 min-h-screen p-6 flex flex-col items-center">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-5xl font-bold text-green-500">askRenewal</h1>
      <p class="mt-4 text-lg text-gray-700 max-w-3xl mx-auto">
        Welcome to askRenewal, your IT Directory for all IT-related issues.<br />
        The goal of this page is to help you figure out who you need to contact
        based on the IT issue you are having.<br />
        Please fill out the form below and follow the instructions presented
        based on your selections in the drop-down menus.
      </p>
    </div>

    <!-- Chat Container -->
    <div class="bg-white shadow-md rounded-lg p-6 w-full max-w-3xl">
      <div
        id="chat-box"
        class="chat-box flex flex-col max-h-80 overflow-y-auto border border-gray-300 rounded-md p-4 bg-gray-50 mb-4 space-y-2"
      >
        <!-- Messages will be injected here -->
      </div>

      <!-- Input Area -->
      <div class="space-y-2">
        <input
          type="text"
          id="user-input"
          placeholder="Enter your name..."
          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-400"
        />

        <select
          id="issue-select"
          class="w-full px-4 py-2 border border-gray-300 rounded-md hidden"
        >
          <option value="">-- Select Issue --</option>
          <option value="password">Password</option>
          <option value="email">Email</option>
          <option value="software">Software</option>
          <option value="hardware">Hardware</option>
          <option value="network">Network</option>
          <option value="other">Other</option>
        </select>

        <select
          id="software-select"
          class="w-full px-4 py-2 border border-gray-300 rounded-md hidden"
        >
          <option value="">-- Select Software --</option>
          <option value="ms-365-apps">MS-365 Apps</option>
          <option value="enabled">Enabled +</option>
          <option value="rforce/rSuite">rForce / rSuite</option>
          <option value="ensemble">Ensemble</option>
          <option value="five9">Five9</option>
          <option value="other">Other</option>
        </select>

        <button
          onclick="handleSelection()"
          class="w-full bg-green-500 text-white py-2 rounded-md hover:bg-green-600"
        >
          Send
        </button>

        <button
          onclick="resetChat()"
          class="w-full bg-gray-500 text-white py-2 rounded-md hover:bg-gray-600 mt-2"
        >
          Restart
        </button>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
      let currentQuestion = 0;
      let userName = "";

      const chatBox = document.getElementById("chat-box");

      const responses = {
        password:
          "Please try resetting your password via control alt delete. If locked out, contact Internal IT.",
        email: "Contact Apex for email issues or third-party services.",
        software: "Please select the software from the dropdown.",
        hardware: "Contact Internal IT or submit a ticket.",
        network: "For network issues, reach out to Apex.",
        other: "Submit an IT ticket for assistance.",
      };

      const softwareSupport = {
        "ms-365-apps":
          "For Microsoft Office issues, contact Internal IT (Angel/Derrick).",
        "enabled": `For Enabled + issues, contact fetch: 
    <a href="tel:18887228610" class="text-blue-600 underline">1-888-722-8610</a> / 
    <a href="https://andersenprod.service-now.com/csm" target="_blank" class="text-blue-600 underline">ServiceNow Portal</a>`,
        "rforce/rSuite": `For rForce/rSuite, contact fetch: 
    <a href="tel:18887228610" class="text-blue-600 underline">1-888-722-8610</a> / 
    <a href="https://andersenprod.service-now.com/csm" target="_blank" class="text-blue-600 underline">ServiceNow Portal</a>`,
        "ensemble": `For Ensemble, contact fetch: 
    <a href="tel:18887228610" class="text-blue-600 underline">1-888-722-8610</a> / 
    <a href="https://andersenprod.service-now.com/csm" target="_blank" class="text-blue-600 underline">ServiceNow Portal</a>`,
        "five9": `For Five9, contact <a href="mailto:angel.chaple@example.com" class="text-blue-600 underline">Angel Chaple</a>.`,
        "other": "Submit an IT ticket for guidance.",
      };

      function addMessage(message, sender = "bot") {
        const div = document.createElement("div");
        div.innerHTML = message;
        div.className = `p-2 rounded-md max-w-[75%] ${
          sender === "user"
            ? "bg-green-100 text-right ml-auto"
            : "bg-gray-200 text-left"
        }`;
        div.classList.add("chat-message", sender);
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function sendToGoogleSheet(name, issue) {
        fetch(
          "https://script.google.com/macros/s/AKfycbwvbyjaXUnFkNhqEofQ3TDATHJ2DQgfJoiAiyy9I7VtAb7nguq1VEjyGRBrwgcj27QF0w/exec",
          {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name: name, issue: issue }),
          }
        ).catch((error) => console.error("Error:", error));
      }

      function handleSelection() {
        const nameInput = document.getElementById("user-input");
        const issueSelect = document.getElementById("issue-select");
        const softwareSelect = document.getElementById("software-select");

        if (currentQuestion === 0) {
          const name = nameInput.value.trim();
          if (!name) return;
          userName = name;
          addMessage(name, "user");
          addMessage(
            `Nice to meet you, ${userName}! What kind of problem are you having?`,
            "bot"
          );
          nameInput.classList.add("hidden");
          issueSelect.classList.remove("hidden");
          currentQuestion++;
          return;
        }

        if (!softwareSelect.classList.contains("hidden")) {
          const software = softwareSelect.value;
          if (!software) return;
          addMessage(software, "user");
          addMessage(softwareSupport[software], "bot");
          sendToGoogleSheet(userName, software);
          softwareSelect.classList.add("hidden");
          issueSelect.classList.add("hidden");
          return;
        }

        if (!issueSelect.classList.contains("hidden")) {
          const issue = issueSelect.value;
          if (!issue) return;
          addMessage(issue, "user");
          addMessage(responses[issue], "bot");
          sendToGoogleSheet(userName, issue);

          if (issue === "software") {
            softwareSelect.classList.remove("hidden");
          } else {
            issueSelect.classList.add("hidden");
          }
          return;
        }
      }

      function resetChat() {
        chatBox.innerHTML = "";
        document.getElementById("user-input").classList.remove("hidden");
        document.getElementById("issue-select").classList.add("hidden");
        document.getElementById("software-select").classList.add("hidden");
        document.getElementById("user-input").value = "";
        currentQuestion = 0;
        userName = "";
        addMessage("Hello, please enter your full name:", "bot");
      }

      addMessage("Hello, please enter your full name:", "bot");
    </script>
  </body>
</html>
